---
title: Installing and Configuring Anti-Virus Mirror for VMware Tanzu
owner: Platform Security & Compliance Team
---
<strong><%= modified_date %></strong>

This topic tells you how to install and configure <%= vars.product_full_mirror %>.

If you do not have an external mirror for Anti-Virus jobs to fetch database updates from,
you can deploy a mirror using the <%= vars.product_short_mirror %> tile.

> **Important** Install this tile before installing <%= vars.product_full %>.

## <a id="overview"></a> Overview

This deployed internal mirror, which uses mutual TLS (mTLS), can support both air-gapped
environments and <%= vars.product_short_mirror %> networked environments:

* **Online Network:** You can deploy the internal <%= vars.product_short_mirror %> as a proxy.
  This acts as a database for the virus definitions if the online virus database experiences downtime.
* **Air-gapped Network:** Because there is no access to an outside network,
  the internal <%= vars.product_short_mirror %> VM acts as the server for the virus definitions.

If you have already deployed an external mirror, you can use that instead of
installing this tile, and continue to [Installing and Configuring <%= vars.product_full %>](./install.html).

To install <%= vars.product_short_mirror %>, complete all sections in this topic.

## <a id="prereqs"></a> Prerequisites

To install the <%= vars.product_short_mirror %>, you must have:

* **Tanzu Operations Manager operator user account with admin rights**. For more information, see
  [Platform Operators](https://docs.vmware.com/en/VMware-Tanzu-Operations-Manager/3.0/vmware-tanzu-ops-manager/install-platform-operators.html).

* **<%= vars.ops_manager_full %>**.
For compatible versions, see the [Product Snapshot](./index.html#snapshot).

* **At least 4&nbsp;GB of RAM free for each VM that installs <%= vars.product_short %>**.
This is so that you can install the <%= vars.product_full %> tile after deploying this mirror.
<%= vars.product_short %> installs itself on each tile VM and runs internally.
<%= vars.product_short %> takes at least 3&nbsp;GB of RAM on each VM and on each VM in reserve.
On Google Cloud Platform (GCP), the recommended minimum VM size is `micro.cpu`
using 2&nbsp;CPU and 4&nbsp;GB RAM.

## <a id='install-mirror'></a> Install <%= vars.product_full_mirror %>

To install the <%= vars.product_full_mirror %> tile:

1. Download the product file from [<%= vars.product_network %>](https://network.tanzu.vmware.com/products/p-clamav-addon).

    For air-gapped networks, follow your company's offline installation protocols.
      For more information, see [Installing Tanzu Operations Manager in air-gapped environments](https://docs.vmware.com/en/VMware-Tanzu-Operations-Manager/3.0/vmware-tanzu-ops-manager/install-offline_installation.html) in the
Tanzu Operations Manager documentation.

1. Go to the Tanzu Operations Manager Installation Dashboard and select **Import a Product** to upload the product file.

1. Under the **Import a Product** button, click **+** next to the version number of <%= vars.product_full_mirror %>.
This adds the tile to your staging area.

1. Click the newly added **<%= vars.product_full_mirror %>** tile.

## <a id='azs'></a> Assign AZs and Networks

To assign availability zones (AZs) and networks:

1. Select **Assign AZs and Networks**.

   ![The "Assign AZs and Networks" pane as described in the following text.](images/mirror-assign-azs.png)

1. Configure the fields as follows:

     <table class=“table”>
     <thead><tr>
      <th>Field</th>
      <th>Description</th>
      </tr></thead>
      <tr>
        <td><strong>Place singleton jobs in</strong></td>
        <td>Select an AZ. If you install only one <%= vars.product_short_mirror %> VM,
            this is the AZ that it is placed in.</td>
      </tr>
      <tr>
        <td><strong>Balance other jobs in</strong></td>
        <td>Select one or more AZs.
            If you install more than one <%= vars.product_short_mirror %> VM,
            these are the AZs that the VMs are placed in.</td>
      </tr>
      <tr>
        <td><strong>Network</strong></td>
        <td>Select a subnet for the <code>antivirus_mirror</code> VM.
          <br>This is typically the same subnet that
          includes the <%= vars.app_runtime_full %> (<%= vars.app_runtime_abbr %>) component VMs.</td>
      </tr>
    </table>

2. Click **Save**.

## <a id='configure-mirror'></a> Configure <%= vars.product_short_mirror %>

To configure <%= vars.product_short_mirror %>:

1. Select **Anti-Virus Mirror Configuration**.

   ![The Anti-Virus Mirror Configuration pane as described in the following text.](images/mirror-configure.png)

1. Configure the fields as follows:

    <table class=“table”>
     <thead><tr>
     <th>Field</th><th>Instructions</th>
     </tr></thead>
     <tr>
        <td><strong>Log output destination</strong></td>
        <td>
          <br>
          Select the file descriptor to forward your logs through:
          <br>
          <ul>
            <li><strong>stdout</strong>: sends messages to <code>/var/vcap/sys/log/antivirus-mirror/antivirus-mirror.stdout.log</code></li>
            <li><strong>stderr</strong>: sends messages to <code>/var/vcap/sys/log/antivirus-mirror/antivirus-mirror.stderr.log</code></li>
            <li><strong>syslog</strong>: sends messages to <code>/var/log/messages</code></li>
          </ul>
        </td>
      </tr>
      <tr>
        <td><strong>Anti-Virus Mirror Port</strong></td>
        <td>
          <br>
          Enter the port for Anti-Virus Mirror to use.
          The default value is <code>6501</code>.
          <br><br>
          <p class="note caution">
            <span class="note__title">Caution</span> <%= vars.product_short_mirror %> uses mTLS. This port must be the same port used in <strong>Anti-Virus Mirror Port</strong> of the <strong><%= vars.product_full %></strong> tile. If these ports are not the same, <%= vars.product_short %> database updates and deployments fail.
        </td>
      </tr>
      <tr>
        <td><strong>Mirror for Automatic Database Updates</strong></td>
        <td>
          <ul>
            Select the mirror to use:
            <li><strong>No mirror</strong>: Select this for air-gapped environments, or to control the database versions available to your environment.</li>
            <li><strong>Official mirror</strong>: Select this to have the mirror fetch databases from the official virus database mirror.</li>
            <li><strong>Existing mirror</strong>: Select this to use your existing mirror.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <td><strong>Official mirror</strong></td>
        <td>
          <br>
          Select this to have the mirror fetch databases from the official virus database mirror.
          <br>
          <ul>
            <li><strong>Number of database checks per day  (min: 1, max: 50) </strong>: Enter the number of database checks that the mirror performs per day. The default value is <code>12</code>.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <td><strong>Existing mirror</strong></td>
        <td>
          <ul>
            <li><strong>Comma separated list of mirror host names or IPs</strong>: Enter a list of host names or IPs of mirrors.</li>
            <li><strong>Number of database checks per day  (min: 1, max: 50)</strong>: Enter the number of database checks the mirror performs per day. The default value is <code>12</code>.</li>
          </ul>
        </td>
      </tr>
    </table>

    <p class="note"><span class="note__title">Note</span> <%= vars.product_full_mirror %> serves
      virus definitions to your environment for <%= vars.product_full %> to use,
      but the <%= vars.product_short %> mirror needs to get databases itself.
      You can configure the Anti-Virus mirror to get virus definitions by using the
      supported options in the preceding section, <strong>Mirror for Automatic Database Updates</strong>.
    </p>

2. Click **Save**.

3. (Optional) If you selected **Official mirror** or **Existing mirror** in the previous section,
 you can configure a proxy for the <%= vars.product_short %> mirror to retrieve the databases from.
 To do this:

    1. Select **HTTP Proxy Configuration**.

        ![Under the "HTTP proxy to get database updates" heading, the Enabled button is selected. The fields are described in following text.](images/mirror-http-proxy.png)

    2. Set **HTTP proxy to get database updates** to **Enabled**.

    3. Enter the **host**, **port**, **username**, and **password** in the fields that appear.

    4. Click **Save**.

## <a id="apply-changes-mirror"></a> Apply Changes from Your Configuration

Your <%= vars.product_short_mirror %> installation is not complete until you apply your configuration changes.
To apply your changes:

1. Return to the Tanzu Operations Manager Installation Dashboard.

1. Click **Review Pending Changes**.
1. Unselect all products except **BOSH Director** and **<%= vars.product_short_mirror %>** and click **Apply Changes**.
1. After **Apply Changes** is complete, if you selected **No Mirror**, upload a set of virus definitions
to your deployed `antivirus-mirrors`.
To do this, see [Updating Virus Definitions](./updating-databases.html).
